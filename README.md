# UnderwriteIQ Lite - API Backend

Credit report analyzer backend for FundHub. Parses credit reports, determines funding eligibility, generates dispute letters, and syncs with GoHighLevel CRM.

---

## How It Works (Simple Overview)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸ¦ CREDIT ANALYZER JOURNEY                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   ğŸ“¤ STEP 1: UPLOAD                                                            â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â•‘
â•‘   User uploads their credit report PDF on fundhub.ai                          â•‘
â•‘   (Experian, Equifax, or TransUnion - up to 3 files)                          â•‘
â•‘                                                                                â•‘
â•‘                              â¬‡ï¸                                                â•‘
â•‘                                                                                â•‘
â•‘   ğŸ” STEP 2: AI READS THE REPORT                                               â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â•‘
â•‘   Text extraction â†’ GPT-4o-mini (fast & cheap)                                â•‘
â•‘   Falls back to GPT-4.1 Vision for scanned PDFs                               â•‘
â•‘                                                                                â•‘
â•‘   Extracts:                                                                    â•‘
â•‘   â€¢ Credit score                                                               â•‘
â•‘   â€¢ Credit card balances & limits                                             â•‘
â•‘   â€¢ Negative items (collections, late payments)                               â•‘
â•‘   â€¢ Hard inquiries                                                             â•‘
â•‘   â€¢ Personal info (name, addresses)                                           â•‘
â•‘                                                                                â•‘
â•‘                              â¬‡ï¸                                                â•‘
â•‘                                                                                â•‘
â•‘   âœ… STEP 3: VERIFY IDENTITY                                                   â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â•‘
â•‘   System checks:                                                               â•‘
â•‘   â€¢ Does the name match the report? âœ“                                         â•‘
â•‘   â€¢ Is the report less than 30 days old? âœ“                                    â•‘
â•‘                                                                                â•‘
â•‘                              â¬‡ï¸                                                â•‘
â•‘                                                                                â•‘
â•‘   ğŸ“Š STEP 4: ANALYZE & DECIDE                                                  â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â•‘
â•‘                                                                                â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘   â”‚                    FUNDABLE CRITERIA                                 â”‚     â•‘
â•‘   â”‚                                                                      â”‚     â•‘
â•‘   â”‚   âœ… Credit Score 700+                                               â”‚     â•‘
â•‘   â”‚   âœ… Credit Utilization 30% or less                                  â”‚     â•‘
â•‘   â”‚   âœ… Zero negative accounts                                          â”‚     â•‘
â•‘   â”‚                                                                      â”‚     â•‘
â•‘   â”‚   ALL THREE = APPROVED FOR FUNDING ğŸ‰                                â”‚     â•‘
â•‘   â”‚   MISSING ANY = CREDIT REPAIR PATH ğŸ”§                                â”‚     â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                                â•‘
â•‘                      â¬‡ï¸                    â¬‡ï¸                                  â•‘
â•‘                                                                                â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â•‘
â•‘   â”‚  ğŸ‰ FUNDING PATH     â”‚         â”‚  ğŸ”§ REPAIR PATH      â”‚                   â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â•‘
â•‘   â”‚                      â”‚         â”‚                      â”‚                   â•‘
â•‘   â”‚ You qualify for      â”‚         â”‚ Let's fix your       â”‚                   â•‘
â•‘   â”‚ business funding!    â”‚         â”‚ credit first!        â”‚                   â•‘
â•‘   â”‚                      â”‚         â”‚                      â”‚                   â•‘
â•‘   â”‚ ğŸ“§ 6 Letters:        â”‚         â”‚ ğŸ“§ 12 Letters:       â”‚                   â•‘
â•‘   â”‚ â€¢ 3 inquiry removal  â”‚         â”‚ â€¢ 9 dispute letters  â”‚                   â•‘
â•‘   â”‚ â€¢ 3 personal info    â”‚         â”‚   (3 rounds Ã— 3      â”‚                   â•‘
â•‘   â”‚                      â”‚         â”‚    bureaus)          â”‚                   â•‘
â•‘   â”‚                      â”‚         â”‚ â€¢ 3 personal info    â”‚                   â•‘
â•‘   â”‚                      â”‚         â”‚                      â”‚                   â•‘
â•‘   â”‚ Shows total funding  â”‚         â”‚ Shows what to fix    â”‚                   â•‘
â•‘   â”‚ amount available     â”‚         â”‚ and how              â”‚                   â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â•‘
â•‘                                                                                â•‘
â•‘                              â¬‡ï¸                                                â•‘
â•‘                                                                                â•‘
â•‘   ğŸ“¬ STEP 5: DELIVER RESULTS                                                   â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â•‘
â•‘   â€¢ PDF letters uploaded (available for 72 hours)                             â•‘
â•‘   â€¢ Contact created/updated in GoHighLevel CRM                                â•‘
â•‘   â€¢ Email sent with results and letter links                                  â•‘
â•‘   â€¢ User redirected to results page                                           â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Processing Time

| Mode | File Size | Typical Time | Cost |
|------|-----------|--------------|------|
| **Text** (default) | Any | 5-15 seconds | ~$0.001-0.005 |
| **Vision** (fallback) | Small (< 3MB) | 30-45 seconds | ~$0.02-0.05 |
| **Vision** (fallback) | Large (> 6MB) | 60-90 seconds | ~$0.02-0.05 |

Text mode is **10-20x cheaper** and **3-4x faster** than Vision mode.

### PDF Processing Flow

The system uses a **smart 3-tier extraction strategy** optimized for speed and accuracy:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PDF PROCESSING DECISION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              PDF Uploaded
                                   â”‚
                                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  STEP 1: pdf-parse           â”‚
                    â”‚  (instant text extraction)   â”‚
                    â”‚  â€¢ Extracts text layer       â”‚
                    â”‚  â€¢ ~50ms for 30 pages        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  STEP 2: Validate Text       â”‚
                    â”‚  Is this a credit report?    â”‚
                    â”‚  â€¢ Has bureau names?         â”‚
                    â”‚  â€¢ Has score patterns?       â”‚
                    â”‚  â€¢ Has account terms?        â”‚
                    â”‚  â€¢ Has dates & amounts?      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚
                    â–¼                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  VALID TEXT   â”‚            â”‚ INVALID/EMPTY â”‚
            â”‚  (High conf)  â”‚            â”‚ (Scanned PDF) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                             â”‚
                    â–¼                             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Send to LLM     â”‚         â”‚  STEP 3: Google  â”‚
         â”‚  (GPT-4o-mini)   â”‚         â”‚  OCR (parallel)  â”‚
         â”‚  ~5-10 seconds   â”‚         â”‚  ~5-10 seconds   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                             â”‚
                    â–¼                             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  âœ… DONE         â”‚         â”‚  Send to LLM     â”‚
         â”‚  Total: 5-10s    â”‚         â”‚  (GPT-4o-mini)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  âœ… DONE         â”‚
                                   â”‚  Total: 15-20s   â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                   (If OCR fails)
                                              â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  STEP 4: Vision  â”‚
                                   â”‚  (GPT-4.1)       â”‚
                                   â”‚  Last resort     â”‚
                                   â”‚  ~30-60 seconds  â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why pdf-parse first?**
- **Faster**: Instant text extraction vs image conversion
- **More accurate**: No OCR errors on digitally-generated PDFs (0 vs O, 1 vs l)
- **Cheaper**: Skip expensive Vision API calls when not needed

**When does OCR get used?**
| PDF Type | pdf-parse | OCR Used? |
|----------|-----------|-----------|
| Digitally-generated (TransUnion, IdentityIQ, SmartCredit) | âœ… Works | âŒ No |
| Scanned paper report | âŒ No text layer | âœ… Yes |
| Screenshot/photo PDF | âŒ No text layer | âœ… Yes |
| Protected/encrypted PDF | âŒ Fails | âœ… Yes |

### What Users See

1. **Upload Page** â†’ Form to enter name, email, phone, and upload PDF
2. **Loading Screen** â†’ Progress bar with estimated time remaining
3. **Results Page** â†’ Either funding approval or repair roadmap

---

## Tech Stack Overview

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ› ï¸ TECHNOLOGY STACK                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   ğŸŒ FRONTEND (What Users See)                                                 â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â•‘
â•‘   â€¢ FundHub Website (fundhub.ai)                                              â•‘
â•‘   â€¢ Hosted on GoHighLevel (GHL)                                               â•‘
â•‘   â€¢ Custom JavaScript for upload & progress                                   â•‘
â•‘                                                                                â•‘
â•‘   â˜ï¸ BACKEND (The Brain)                                                       â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â•‘
â•‘   â€¢ Vercel Serverless Functions                                               â•‘
â•‘   â€¢ Node.js 22                                                                â•‘
â•‘   â€¢ Handles all processing logic                                              â•‘
â•‘                                                                                â•‘
â•‘   ğŸ¤– AI PARSING (Dual-Mode)                                                    â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â•‘
â•‘   â€¢ Primary: Text extraction + GPT-4o-mini (fast & cheap)                     â•‘
â•‘   â€¢ Fallback: GPT-4.1 Vision (for scanned PDFs)                               â•‘
â•‘   â€¢ Mode selection via PARSE_MODE env var (text/vision/auto)                  â•‘
â•‘   â€¢ Understands any credit report format                                      â•‘
â•‘                                                                                â•‘
â•‘   ğŸ“¦ FILE STORAGE                                                              â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘   â”‚  VERCEL BLOB STORAGE                                                 â”‚     â•‘
â•‘   â”‚                                                                      â”‚     â•‘
â•‘   â”‚  â€¢ PDFs uploaded directly from browser (fast!)                      â”‚     â•‘
â•‘   â”‚  â€¢ Generated letters stored here                                    â”‚     â•‘
â•‘   â”‚  â€¢ Links expire after 72 hours (security)                           â”‚     â•‘
â•‘   â”‚  â€¢ No files stored permanently                                      â”‚     â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                                â•‘
â•‘   ğŸ—„ï¸ DATABASE / CACHE                                                         â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘   â”‚  UPSTASH REDIS                                                       â”‚     â•‘
â•‘   â”‚                                                                      â”‚     â•‘
â•‘   â”‚  â€¢ Job tracking (upload progress)                                   â”‚     â•‘
â•‘   â”‚  â€¢ 30-day result caching (same user = instant results)              â”‚     â•‘
â•‘   â”‚  â€¢ Rate limiting (prevents abuse)                                   â”‚     â•‘
â•‘   â”‚  â€¢ No personal data stored (only hashed IDs)                        â”‚     â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                                â•‘
â•‘   ğŸ“§ CRM & EMAIL                                                               â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘   â”‚  GOHIGHLEVEL (GHL)                                                   â”‚     â•‘
â•‘   â”‚                                                                      â”‚     â•‘
â•‘   â”‚  â€¢ Contact management                                               â”‚     â•‘
â•‘   â”‚  â€¢ Automated email sequences                                        â”‚     â•‘
â•‘   â”‚  â€¢ Workflow triggers (repair vs funding)                            â”‚     â•‘
â•‘   â”‚  â€¢ Letter delivery via email                                        â”‚     â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    USER      â”‚     â”‚   VERCEL     â”‚     â”‚   OPENAI     â”‚     â”‚     GHL      â”‚
â”‚   BROWSER    â”‚     â”‚   BACKEND    â”‚     â”‚              â”‚     â”‚     CRM      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  1. Upload PDF     â”‚                    â”‚                    â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                    â”‚                    â”‚
       â”‚    (to Blob)       â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  2. Start job      â”‚                    â”‚                    â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  3a. Extract text  â”‚                    â”‚
       â”‚                    â”‚     (pdf-parse)    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  3b. Parse text    â”‚                    â”‚
       â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ GPT-4o-mini        â”‚
       â”‚                    â”‚                    â”‚ (fast/cheap)       â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  OR if scanned:    â”‚                    â”‚
       â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ GPT-4.1 Vision     â”‚
       â”‚                    â”‚                    â”‚ (fallback)         â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  4. Credit data    â”‚                    â”‚
       â”‚                    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â”‚  5. Create contact + send letters       â”‚
       â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  6. Results ready  â”‚                    â”‚                    â”‚
       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚  7. Redirect to    â”‚                    â”‚                    â”‚
       â”‚     results page   â”‚                    â”‚                    â”‚
       â–¼                    â–¼                    â–¼                    â–¼
```

### Security & Privacy

| Aspect | How We Handle It |
|--------|------------------|
| **PDF Storage** | Uploaded to Vercel Blob, deleted after processing |
| **Letter Storage** | 72-hour expiry links, then auto-deleted |
| **Personal Data** | Only stored in GHL (your CRM) |
| **Caching** | Uses hashed IDs only, no PII in Redis |
| **Rate Limiting** | Prevents abuse, 10 requests per minute |

---

## Concurrent Users & Queue System

### Current State (No Queue)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    âš ï¸ CURRENT: SYNCHRONOUS PROCESSING                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   When 5 users upload at the same time:                                       â•‘
â•‘                                                                                â•‘
â•‘   User 1 â”€â”€â”                                                                   â•‘
â•‘   User 2 â”€â”€â”¼â”€â”€â–º ALL hit OpenAI API simultaneously â”€â”€â–º âš ï¸ RATE LIMITS!         â•‘
â•‘   User 3 â”€â”€â”¤                                                                   â•‘
â•‘   User 4 â”€â”€â”¤    Result: Some users get TIMEOUTS                               â•‘
â•‘   User 5 â”€â”€â”˜                                                                   â•‘
â•‘                                                                                â•‘
â•‘   Performance under load:                                                      â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â•‘
â•‘   â”‚ Concurrent Users    â”‚ Success Rate     â”‚                                  â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â•‘
â•‘   â”‚ 1-3 users           â”‚ âœ… ~100%          â”‚                                  â•‘
â•‘   â”‚ 5 users             â”‚ âš ï¸ ~60-80%        â”‚                                  â•‘
â•‘   â”‚ 10 users            â”‚ âŒ ~20-40%        â”‚                                  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Planned: Queue-Based Processing

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸš€ PLANNED: QUEUE-BASED PROCESSING                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘   When 5 users upload at the same time:                                       â•‘
â•‘                                                                                â•‘
â•‘   User 1 â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â•‘
â•‘   User 2 â”€â”€â”¼â”€â”€â–º   â”‚   REDIS     â”‚ â”€â”€â–º  â”‚   WORKER    â”‚ â”€â”€â–º OpenAI            â•‘
â•‘   User 3 â”€â”€â”¤      â”‚   QUEUE     â”‚      â”‚ (processes  â”‚     (one at           â•‘
â•‘   User 4 â”€â”€â”¤      â”‚             â”‚      â”‚  2-3 jobs   â”‚      a time)           â•‘
â•‘   User 5 â”€â”€â”˜      â”‚ [1,2,3,4,5] â”‚      â”‚  per tick)  â”‚                        â•‘
â•‘                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â•‘
â•‘                                                                                â•‘
â•‘   Benefits:                                                                    â•‘
â•‘   âœ… No more timeouts - jobs queue up instead of competing                    â•‘
â•‘   âœ… Fair ordering - first come, first served                                 â•‘
â•‘   âœ… 100% success rate under any load                                         â•‘
â•‘   â±ï¸ Trade-off: Higher load = longer wait times                               â•‘
â•‘                                                                                â•‘
â•‘   Expected wait times:                                                         â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â•‘
â•‘   â”‚ Queue Position      â”‚ Wait Time        â”‚                                  â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â•‘
â•‘   â”‚ Position 1          â”‚ ~60 seconds      â”‚                                  â•‘
â•‘   â”‚ Position 5          â”‚ ~3 minutes       â”‚                                  â•‘
â•‘   â”‚ Position 10         â”‚ ~6 minutes       â”‚                                  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â•‘
â•‘                                                                                â•‘
â•‘   Status: ğŸ“‹ PLANNED (requires Vercel Pro for faster cron intervals)          â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Queue Architecture (When Implemented)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BROWSER   â”‚     â”‚  VERCEL     â”‚     â”‚   REDIS     â”‚     â”‚   WORKER    â”‚
â”‚             â”‚     â”‚  API        â”‚     â”‚   QUEUE     â”‚     â”‚   (CRON)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 1. Upload PDF     â”‚                   â”‚                   â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚ 2. Add to queue   â”‚                   â”‚
       â”‚                   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 3. "Queued #5"    â”‚                   â”‚                   â”‚
       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚ 4. Every 10-60s   â”‚
       â”‚                   â”‚                   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                   â”‚                   â”‚    "Next job?"    â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚ 5. Pop job        â”‚
       â”‚                   â”‚                   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚    6. Process     â”‚
       â”‚                   â”‚                   â”‚    (OpenAI call)  â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 7. Poll status    â”‚                   â”‚                   â”‚
       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚
       â”‚                   â”‚                   â”‚                   â”‚
       â”‚ 8. "Complete!"    â”‚                   â”‚                   â”‚
       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼                   â–¼
```

### Implementation Options

| Option | Pros | Cons |
|--------|------|------|
| **Vercel Cron (Pro)** | Simple, built-in | Requires Pro plan ($20/mo), min 10s interval |
| **Upstash QStash** | Sub-second delivery, retries | Additional service, extra cost |
| **Self-triggered** | Works on Hobby plan | Complex, less reliable |

---

## Architecture Overview (Technical)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT FLOW                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   [User Upload]                                                              â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚   â”‚  FundHub Website â”‚  (fundhub-website-GHL repo)                          â”‚
â”‚   â”‚  credit-analyzer â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚            â”‚ POST /api/lite/switchboard                                      â”‚
â”‚            â”‚ (PDF + name + email + phone)                                    â”‚
â”‚            â–¼                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           VERCEL BACKEND                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        SWITCHBOARD                                   â”‚   â”‚
â”‚   â”‚                    (api/lite/switchboard.js)                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                                 â”‚
â”‚            â–¼                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  Stage 1        â”‚     â”‚  Stage 2        â”‚     â”‚  Stage 3        â”‚       â”‚
â”‚   â”‚  Pre-Validate   â”‚â”€â”€â”€â”€â–¶â”‚  AI Parse       â”‚â”€â”€â”€â”€â–¶â”‚  Bureau Merge   â”‚       â”‚
â”‚   â”‚  (size, type,   â”‚     â”‚  (text+4o-mini  â”‚     â”‚  (dedupe check) â”‚       â”‚
â”‚   â”‚   duplicates)   â”‚     â”‚  or Vision)     â”‚     â”‚                 â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                          â”‚                   â”‚
â”‚                                                          â–¼                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  Stage 3b       â”‚     â”‚  Stage 4        â”‚     â”‚  Stage 5        â”‚       â”‚
â”‚   â”‚  Identity Gate  â”‚â”€â”€â”€â”€â–¶â”‚  Underwrite     â”‚â”€â”€â”€â”€â–¶â”‚  Suggestions    â”‚       â”‚
â”‚   â”‚  (name match,   â”‚     â”‚  (score, util,  â”‚     â”‚  (optimization  â”‚       â”‚
â”‚   â”‚   30-day check) â”‚     â”‚   fundable?)    â”‚     â”‚   cards)        â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                          â”‚                   â”‚
â”‚                                                          â–¼                   â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                                              â”‚                       â”‚       â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”‚
â”‚                                        â”‚ FUNDABLE  â”‚           â”‚  REPAIR   â”‚ â”‚
â”‚                                        â”‚ Scoreâ‰¥700 â”‚           â”‚ Otherwise â”‚ â”‚
â”‚                                        â”‚ Utilâ‰¤30%  â”‚           â”‚           â”‚ â”‚
â”‚                                        â”‚ Neg=0     â”‚           â”‚           â”‚ â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                              â”‚                       â”‚       â”‚
â”‚                                              â–¼                       â–¼       â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                        â”‚ 6 Letters â”‚           â”‚12 Letters â”‚ â”‚
â”‚                                        â”‚ 3 inquiry â”‚           â”‚ 9 dispute â”‚ â”‚
â”‚                                        â”‚ 3 personalâ”‚           â”‚ 3 personalâ”‚ â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                              â”‚                       â”‚       â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                          â”‚                   â”‚
â”‚                                                          â–¼                   â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                              â”‚   Vercel Blob       â”‚         â”‚
â”‚                                              â”‚   (PDF Storage)     â”‚         â”‚
â”‚                                              â”‚   72hr expiry URLs  â”‚         â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                         â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GOHIGHLEVEL (GHL)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     Inbound Webhook                                  â”‚   â”‚
â”‚   â”‚          (underwriteiq_analyzer_complete)                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                                 â”‚
â”‚            â–¼                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚   â”‚ Contact Upsert  â”‚  (Create or update by email/phone)                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚            â”‚                                                                 â”‚
â”‚            â–¼                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     Custom Fields Mapped                             â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  analyzer_path          = "repair" | "funding"                       â”‚   â”‚
â”‚   â”‚  analyzer_status        = "complete"                                 â”‚   â”‚
â”‚   â”‚  letters_ready          = "true"                                     â”‚   â”‚
â”‚   â”‚  credit_score           = 580                                        â”‚   â”‚
â”‚   â”‚  credit_suggestions     = "Remove negatives..."                      â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  REPAIR LETTERS:                                                     â”‚   â”‚
â”‚   â”‚  repair_letter_round_1_ex/eq/tu                                      â”‚   â”‚
â”‚   â”‚  repair_letter_round_2_ex/eq/tu                                      â”‚   â”‚
â”‚   â”‚  repair_letter_round_3_ex/eq/tu                                      â”‚   â”‚
â”‚   â”‚  repair_letter_personal_info_ex/eq/tu                                â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  FUNDING LETTERS:                                                    â”‚   â”‚
â”‚   â”‚  funding_letter_inquiry_ex/eq/tu                                     â”‚   â”‚
â”‚   â”‚  funding_letter_personal_info_ex/eq/tu                               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                                 â”‚
â”‚            â–¼                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚ Repair Workflow â”‚ OR  â”‚Funding Workflow â”‚                               â”‚
â”‚   â”‚ (email + tags)  â”‚     â”‚ (email + tags)  â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tech Stack

| Component      | Technology                     |
| -------------- | ------------------------------ |
| Backend        | Node.js 22 + Vercel Serverless |
| PDF Text Extraction | pdf-parse                 |
| AI Parsing (Primary) | OpenAI GPT-4o-mini (text mode) |
| AI Parsing (Fallback) | OpenAI GPT-4.1 Vision (scanned PDFs) |
| PDF Generation | pdf-lib                        |
| PDF Storage    | Vercel Blob (72hr URLs)        |
| CRM            | GoHighLevel (GHL)              |
| Cache/Dedupe   | Upstash Redis                  |
| Rate Limiting  | Upstash Ratelimit              |

---

## API Endpoints

| Endpoint                      | Description                              |
| ----------------------------- | ---------------------------------------- |
| `POST /api/lite/switchboard`  | Main analyzer - upload PDFs, get results |
| `POST /api/lite/parse-report` | Parse single PDF (internal)              |
| `GET /api/lite/health`        | Health check                             |

---

## Validation Rules

| Rule             | Stage      | Error Message                      |
| ---------------- | ---------- | ---------------------------------- |
| Max 3 files      | Pre-parse  | "Upload up to 3 PDFs only"         |
| PDF format       | Pre-parse  | "Only PDF credit reports accepted" |
| Min 40KB         | Pre-parse  | "PDF too small to be complete"     |
| Duplicate file   | Pre-parse  | "Duplicate file detected"          |
| Duplicate bureau | Post-parse | "Duplicate Experian detected"      |
| Name mismatch    | Post-parse | "Name does not match report"       |
| Report >30 days  | Post-parse | "Report is X days old"             |

---

## Fundable vs Repair Logic

```
IF score >= 700 AND utilization <= 30% AND negatives = 0:
    â†’ FUNDABLE PATH (6 letters)
ELSE:
    â†’ REPAIR PATH (12 letters)
```

---

## Letter Generation

### Repair Path (12 letters)

- 9 dispute letters (3 rounds Ã— 3 bureaus)
- 3 personal info letters (1 per bureau)

### Fundable Path (6 letters)

- 3 inquiry removal letters (1 per bureau)
- 3 personal info letters (1 per bureau)

---

## Environment Variables

```bash
# OpenAI
UNDERWRITE_IQ_VISION_KEY=sk-...

# Parse Mode: text (cheap/fast), vision (accurate), auto (text with fallback)
PARSE_MODE=auto

# Model for text-based parsing (default: gpt-4o-mini)
PARSE_MODEL=gpt-4o-mini

# Vercel Blob
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_...

# GoHighLevel
GHL_API_BASE=https://services.leadconnectorhq.com
GHL_PRIVATE_API_KEY=pit-...
GHL_LOCATION_ID=...

# Upstash Redis (dedupe/rate limit)
UPSTASH_REDIS_REST_URL=https://...
UPSTASH_REDIS_REST_TOKEN=...

# Redirects
REDIRECT_URL_FUNDABLE=https://fundhub.ai/funding-approved
REDIRECT_URL_NOT_FUNDABLE=https://fundhub.ai/fix-my-credit
```

---

## Project Structure

```
underwrite-iq-lite/
â”œâ”€â”€ api/lite/
â”‚   â”œâ”€â”€ switchboard.js        # Main orchestrator
â”‚   â”œâ”€â”€ parse-report.js       # AI parser (text + vision modes)
â”‚   â”œâ”€â”€ pdf-text-extractor.js # Text extraction from PDFs
â”‚   â”œâ”€â”€ validate-reports.js   # Pre-parse validation
â”‚   â”œâ”€â”€ validate-identity.js  # Name match + 30-day check
â”‚   â”œâ”€â”€ underwriter.js        # Fundable/repair logic
â”‚   â”œâ”€â”€ letter-generator.js   # PDF letter creation
â”‚   â”œâ”€â”€ letter-delivery.js    # Letter orchestration
â”‚   â”œâ”€â”€ storage.js            # Vercel Blob uploads
â”‚   â”œâ”€â”€ ghl-contact-service.js # GHL API integration
â”‚   â”œâ”€â”€ suggestions.js        # Optimization suggestions
â”‚   â”œâ”€â”€ dedupe-store.js       # Redis cache
â”‚   â”œâ”€â”€ rate-limiter.js       # Rate limiting
â”‚   â”œâ”€â”€ ai-gatekeeper.js      # Pre-parse AI check
â”‚   â””â”€â”€ __tests__/            # 354 tests
â”œâ”€â”€ package.json
â””â”€â”€ vercel.json
```

---

## Development

```bash
# Install
npm install

# Run locally
npm run dev

# Run tests
npm test

# Lint
npm run lint
```

---

## Deployment

- **Staging:** Push to `staging` branch â†’ auto-deploys to `underwrite-iq-lite-staging.vercel.app`
- **Production:** Merge to `main` â†’ auto-deploys to `underwrite-iq-lite.vercel.app`

---

## GHL Webhook Payload

```json
{
  "first_name": "John",
  "last_name": "Doe",
  "email": "john@example.com",
  "phone": "5551234567",
  "business_name": "Acme LLC",
  "business_age_months": 24,

  "analyzer_path": "repair",
  "analyzer_status": "complete",
  "letters_ready": "true",

  "credit_score": 580,
  "credit_utilization": 45,
  "negative_accounts": 3,
  "credit_suggestions": "Remove collections...",

  "repair_letter_round_1_ex": "https://...",
  "repair_letter_round_1_eq": "https://...",
  "repair_letter_round_1_tu": "https://...",
  "repair_letter_personal_info_ex": "https://...",
  ...
}
```

---

## Testing

```bash
# Run all tests
npm test

# Run specific test file
npm test -- api/lite/__tests__/validate-identity.test.js
```

Current: **354 tests passing**
