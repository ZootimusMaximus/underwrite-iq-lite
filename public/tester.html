<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>UnderwriteIQ — Internal System Monitor</title>

<style>
  body {
    margin: 0;
    background: #000;
    color: #7dfc8a;
    font-family: monospace;
    padding: 20px;
  }

  h1 {
    color: #6fffa3;
    margin-bottom: 16px;
  }

  #dropzone {
    border: 1px dashed rgba(0,255,65,0.4);
    padding: 30px;
    text-align: center;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 20px;
  }

  .panel {
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(0,255,65,0.25);
    padding: 14px;
    border-radius: 6px;
    margin-bottom: 20px;
  }

  pre {
    white-space: pre-wrap;
    padding: 10px;
    background: rgba(0,0,0,0.4);
    border-radius: 6px;
    color: #b4ffbf;
    font-size: 14px;
  }
</style>
</head>

<body>

<h1>UnderwriteIQ — Internal System Monitor</h1>

<div id="dropzone">CLICK OR DRAG PDF(s)</div>
<input type="file" id="fileInput" accept="application/pdf" multiple style="display:none">

<div class="panel">
  <h3>Progress</h3>
  <pre id="progress">Waiting…</pre>
</div>

<div class="panel">
  <h3>UnderwriteIQ Summary Output</h3>
  <pre id="summaryOutput">Upload a report…</pre>
</div>

<script src="uwiq-web-logic.js"></script>
<script>
/* ============================================================
   TESTER — PART 1 LOGIC HOOKUP
   ============================================================ */

const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");
const progress = document.getElementById("progress");
const summaryOutput = document.getElementById("summaryOutput");

dropzone.onclick = () => fileInput.click();
dropzone.addEventListener("dragover", e => e.preventDefault());
dropzone.addEventListener("drop", e => {
  e.preventDefault();
  handleFiles(e.dataTransfer.files);
});
fileInput.onchange = () => handleFiles(fileInput.files);

async function handleFiles(files) {
  progress.textContent = "Processing...";
  let idx = 0;

  for (const f of files) {
    idx++;
    progress.textContent = `Processing ${idx}/${files.length}: ${f.name}`;
    await processOne(f);
  }

  progress.textContent = `DONE — ${files.length} file(s) processed`;
}

async function processOne(file) {
  const form = new FormData();
  form.append("file", file);

  let json;
  try {
    const res = await fetch("/api/lite/parse-report", {
      method: "POST",
      body: form
    });

    const text = await res.text();
    try {
      json = JSON.parse(text);
    } catch {
      json = { ok: false, msg: "Parse error", raw: text };
    }

  } catch (err) {
    json = { ok: false, msg: err.toString() };
  }

  // Pass into the logic engine
  const result = UWiq.buildDisplay(json);

  // Show English summary
  summaryOutput.textContent = result.summaryText;
}
</script>
</body>
</html>
